name: Docker build

on:
  # Disabled to not break development
  #push:
    #branches:
      #- main
    #tags:
      #- '*'
  #pull_request:
    #branches:
      #- main
  
  # Only for testing
  workflow_dispatch:

jobs:
  build:
    runs-on: minafoundation-default-runners

    steps:
      - name: üì• Checkout
        uses: actions/checkout@v3

      - name: Login to Amazon ECR
        id: login-ecr
        uses: aws-actions/amazon-ecr-login@v1

      - name: üõ†Ô∏è Build Docker
        # https://github.com/marketplace/actions/docker-build-push-action
        uses: mr-smithers-excellent/docker-build-push@v6
        with:
          image: 673156464838.dkr.ecr.us-west-2.amazonaws.com/gpt-survey-summarizer
          tags: ${{ github.ref_name }}
          registry: 673156464838.dkr.ecr.us-west-2.amazonaws.com
